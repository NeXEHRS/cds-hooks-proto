## API共通仕様
プロトコル
> TCP/IP

リクエストメソッド
> HTTP リクエストメソッドに準ずる（GET/POSGET/POST/PUT/DELETE...etc）

レスポンス
> application/json、application/text

HTTPステータスコード
> 200： 成功
> 400： 不正リクエスト (リソース, パラメータエラー等)
> 401： 認証失敗 (未認証, API トークン期限切れ等) 
> 402： 支払い要求 (ユーザ強制停止中)
> 404： 対象が存在しない 
> 405： 無効メソッド 
> 400： サーバエラー 
> 他 ： [HTTPレスポンスステータスコード](https://ja.wikipedia.org/wiki/HTTP%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89)に準じる

※その他ある場合追記します。



### レスポンス一覧
#### cardの属性
| キー | 任意性 | タイプ | 説明 |
| --- | --- | --- | --- |
| uuid | オプション | string | カードの一意の識別子。カードの監査とログ記録に使用できます (MAY)。また、CDS サービスのフィードバック エンドポイントへの後続の呼び出しに含める必要があります (SHALL)。 |
| summary | 必須 | string | このカード内のユーザーに表示される、1 文、140 文字未満の概要メッセージ。 |
| detail | オプション | string | 表示するオプションの詳細情報。提供されている場合は、 (GitHub Flavored) Markdownで表現する必要があります。(緊急でないカードの場合、CDS クライアントは、ユーザーが「詳細を表示...」などのリンクをクリックするまで、これらの詳細を非表示にしてもよい(MAY)。) |
| indicator | 必須 | string | このカードが伝えることの緊急性/重要性。許可される値は、緊急度の高い順に、 、info、warningですcritical。CDS クライアントは、並べ替え順序や色付けなどの UI 表示の決定を支援するためにこのフィールドを使用してもよい(MAY)。 |
| source | 必須 | object | このカードに表示される情報のソースのグループ構造。情報源は、カードが表す意思決定をサポートするための主要なガイダンス情報源である必要があります。 |
| suggestions | オプション | 提案の配列 | サービスが現在のアクティビティのコンテキストで一連の変更を提案できるようにします (たとえば、アクティビティに対する現在処方されている薬の用量の変更などorder-sign)。提案がある場合は、selectionBehaviorそれも提供しなければなりません。 |
| selectionBehavior | 条件付き | string | カード内の提案の意図された選択動作について説明します。許可される値は次のとおりです。at-most-oneこれは、ユーザーが提案を何も選択しないか、最大でも 1 つしか選択できないことを示します。anyこれは、エンド ユーザーが提案を 1 つも選択しないことも、すべてを選択することも含めて、任意の数を選択できることを示します。値を理解できない CDS クライアントは、カードをエラーとして扱わなければなりません (MUST)。 |
| overrideReasons | オプション | コーディングの配列 | 提案された推奨事項を採用せずにカードをオーバーライドする場合、エンド ユーザーはオーバーライドの理由を選択できます。CDS サービスは、オーバーライド理由のリストを CDS クライアントに返すことができます (MAY)。オーバーライド理由が存在する場合、CDS サービスはdisplay各理由のコーディングの値を設定しなければなりません (MUST) 。CDS クライアントは、臨床医がカードを却下するときに、これらの理由を提示する必要があります (SHOULD)。CDS クライアントは、ユーザーに提示されるオーバーライド理由を独自の理由で補強してもよい (MAY)。 |
| links | オプション | リンクの配列 | ユーザーが追加情報を得るために実行したり、意思決定を支援したりする可能性があるアプリへのリンクをサービスが提案できるようにします。 |

#### sourceの属性
| キー | 任意性 | タイプ | 説明 |
| --- | --- | --- | --- |
| label | 必須 | string | このカードに表示される情報のソースを示す、人間が判読できる短いラベル。urlも指定されている場合、これがハイパーリンクのテキストになる可能性があります。 |
| url | オプション | URL | GETユーザーがこのリンクをクリックして、このカードの情報を提供した組織またはデータ セットの詳細を確認するときに(ブラウザ コンテキストで を介して) ロードするオプションの絶対 URL 。この URL は、このカードの情報のコンテキスト固有の「ドリルダウン」ビューを提供するために使用しないでください。その場合は、代わりにcard.link.urlを使用してください。 |
| icon | オプション | URL | このカードのソースのアイコンへの絶対 URL。この URL によって返されるアイコンは、透明領域のない 100x100 ピクセルの PNG 画像である必要があります。CDS クライアントは、ユーザー エクスペリエンスに応じて、表示中に画像を無視したり拡大縮小したりする場合があります。 |
| topic | オプション | コーディング | トピックは、CDS クライアントの UI での関連カードのフィルタリング、検索、または順序付けされた表示に役立つ高レベルの分類を提供することによって、カードのコンテンツを説明します。この仕様は、標準的な一連のトピックを規定するものではありません。 |

sourceパラメータサンプル
```bash
{ 
  "source" :  { 
    "label" :  "ジカウイルス管理" 、
    "url" :  "https://example.com/cdc-zika-virus-mgmt" 、
    "icon" :  "https://example.com /cdc-zika-virus-mgmt/100.png" , 
    "topic" :  { 
      "system" :  "http://example.org/cds-services/fhir/CodeSystem/topics" , 
      "sode" :  "12345" , 
      "display" :  "蚊が生み出すウイルス" 
    } 
  } 
}
```

#### suggestionの属性
| キー | 任意性 | タイプ | 説明 |
| --- | --- | --- | --- |
| label | 必須 | string | この提案に対して表示する人間が判読できるラベル (たとえば、CDS クライアントはこれを、この提案に関連付けられたボタン上のテキストとしてレンダリングする可能性があります)。 |
| uuid | オプション | string | 提案の監査とログ記録に使用される一意の識別子。 |
| isRecommended | オプション | boolean | 複数の提案がある場合、カード上で利用可能なすべての提案の中から特定の提案が推奨されることをサービスが示すことができます。CDSフック クライアントは、推奨される提案の事前選択や強調表示など、この値に基づいて UI に影響を与えることを選択できます。card.selectionBehaviorの場合、複数の提案が推奨される場合がありますany |
| actions | オプション | アクションの配列 | それぞれが推奨されるアクションを定義するオブジェクトの配列。提案内では、すべてのアクションが論理的にAND演算され、ユーザーが提案を選択すると、その提案内のすべてのアクションが選択されます。提案に複数のアクションが含まれる場合、そのアクションは、トランザクション バンドル エントリの推定された完全な URL のベースURLとしてCDSクライアントを使用してトランザクションを処理するFHIRのルールに従って処理されるべきです (SHOULD) 。fhirServer(具体的には、最初に削除が行われ、次に作成、次に更新が行われます)。 |

#### actionの属性
| キー | 任意性 | タイプ | 説明 |
| --- | --- | --- | --- |
| type | 必須 | string | 実行されるアクションのタイプ。許可される値は次のとおりです: create、update、delete。 |
| description | 必須 | string | 提案されたアクションについての人が判読できる説明をエンドユーザーに提示してもよい(MAY)。 |
| resource | 条件付き | object | FHIR リソース。type属性がcreateの場合、そのresource属性には、作成される新しい FHIRリソースが含まれる必要があります。updateの場合、これは、変更されたフィールドだけでなく、更新されたリソース全体を保持します。削除提案のFHIR IDの文字列を通信するためのこのresourceIdフィールドの使用は非推奨であり、代わりに使用されるべきです。 |
| resourceId | 条件付き | string | 関連するリソースへの相対参照。type属性がdeleteの場合は、指定する必要があります。 |

次の例は、作成アクションを示しています。
```bash
{ 
  "type" :  "create" , 
  "description" :  "アセトアミノフェン 250 MG の処方箋を作成する" , 
  "resource" :  { 
    "resourceType" :  "MedicationRequest" , 
    "id" :  "medrx001" , 
    "..." :  "<簡潔にするために省略>" 
  } 
}
```
次の例は、更新アクションを示しています。
```bash
{ 
  "type" :  "update" , 
  "description" :  "適切性スコアを記録するために順序を更新します" , 
  "resource" :  { 
    "resourceType" :  "ServiceRequest" , 
    "id" :  "procedure-request-1" , 
    " ..." :  "<簡潔にするために省略>" 
  } 
}
```
次の例は、削除アクションを示しています。
```bash
{ 
  "type" :  "delete" , 
  "description" :  "不適切な注文を削除" , 
  "resourceId" :  "ServiceRequest/procedure-request-1" 
}
```
#### カードが拒否される理由
overrideReasons は、エンド ユーザーがカードに提示されたアドバイスを拒否するときに拒否理由として選択できる成文化された一連の理由をキャプチャするコーディングの配列です。理由を表すためにコーディング オブジェクトを使用する場合、CDS サービスは表示プロパティに人間が読めるテキストを提供しなければならず (MUST) 、CDS クライアントはそれをユーザー インターフェイスに組み込んでもよい (MAY)。

この仕様は、オーバーライド理由の標準セットを規定するものではありません。実装者は標準化のための提案を提出することが推奨されます。
```bash
{ 
  "overrideReasons" :  [ 
    { 
      "code" :  "reason-code-provided-by-service" , 
      "system" :  "http://example.org/cds-services/fhir/CodeSystem/override-reasons" , 
      " display" :  "患者が拒否しました" 
    }, 
    { 
      "code" :  "12354" , 
      "system" :  "http://example.org/cds-services/fhir/CodeSystem/override-reasons" , 
      "display" :  "禁忌" 
    } 
  ] 
}
```

#### linkの属性
| キー | 任意性 | タイプ | 説明 |
| --- | --- | --- | --- |
| label | 必須 | string | このリンクに対して表示する人間が判読できるラベル (たとえば、CDS クライアントはこれをクリック可能なリンクの下線付きテキストとしてレンダリングする可能性があります)。 |
| url | 必須 | URL | GETユーザーがこのリンクをクリックしたときに(ブラウザ コンテキストで を介して) 読み込まれる URL 。これは、パス セグメント、クエリ パラメータ、またはハッシュに埋め込まれたコンテキストを持つ「ディープ リンク」であってもよいことに注意してください。 |
| type | 必須 | string | 指定された URL のタイプ。このフィールドには 2 つの値が可能です。このタイプはURL が絶対 URL であり、そのまま扱う必要があることを示します。smartのタイプは、URLがSMARTアプリ起動URLであり、CDSクライアントが SMART アプリ起動URLに、適切なSMART起動パラメータが設定されていることを確認する必要があることを示します |
| appContext | オプション | string | CDS サービスがCDS カードからの情報を、その後起動されるSMARTアプリと共有できるようにするオプションのフィールド。 |